{% extends 'calificaciones/base.html' %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-6">
        <div class="card">
            <div class="card-header bg-warning text-dark">
                <h4 class="mb-0">üîí Verificaci√≥n en Dos Pasos</h4>
            </div>
            <div class="card-body">
                <div class="alert alert-info">
                    <strong>Hola {{ user.nombre }},</strong><br>
                    Se requiere verificaci√≥n adicional para completar el inicio de sesi√≥n.
                </div>

                <div class="text-center mb-4">
                    <div style="font-size: 3rem;">üì±</div>
                    <p class="mb-0">Abre tu app de autenticaci√≥n</p>
                </div>

                <form method="post">
                    {% csrf_token %}
                    
                    {% if form.errors %}
                    <div class="alert alert-danger">
                        <strong>Error:</strong> C√≥digo de verificaci√≥n inv√°lido. Intenta nuevamente.
                    </div>
                    {% endif %}

                    <div class="mb-3">
                        <label for="id_token" class="form-label">C√≥digo de 6 d√≠gitos</label>
                        {{ form.token }}
                        <div class="form-text">
                            Ingresa el c√≥digo de 6 d√≠gitos de tu app de autenticaci√≥n
                        </div>
                    </div>

                    <button type="submit" class="btn btn-primary w-100 py-2">
                        üîê Verificar e Ingresar
                    </button>
                </form>

                <div class="mt-4 text-center">
                    <div class="alert alert-light">
                        <small class="text-muted">
                            <strong>¬øProblemas con el c√≥digo?</strong><br>
                            ‚Ä¢ Aseg√∫rate de que la hora de tu dispositivo est√© sincronizada<br>
                            ‚Ä¢ El c√≥digo cambia cada 30 segundos<br>
                            ‚Ä¢ Verifica que hayas escaneado el c√≥digo QR correctamente
                        </small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.form-control {
    text-align: center;
    font-size: 1.2rem;
    letter-spacing: 0.5em;
    font-weight: bold;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Auto-focus en el campo de c√≥digo
    const tokenInput = document.getElementById('id_token');
    if (tokenInput) {
        tokenInput.focus();
        
        // Auto-avanzar cuando se ingresa un d√≠gito
        tokenInput.addEventListener('input', function(e) {
            if (this.value.length === 6) {
                this.form.submit();
            }
        });
    }
});
</script>
{% endblock %}